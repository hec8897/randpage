<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="css/style.css">
    <title>BM Company</title>
</head>

<body>
    <div id='wrap'>
        <h1 class='test-page-h1'>
            <img src="img/testpageh1.png" alt="">
        </h1>
        <div class='test_box'>
            <input type="text" autocomplete="off">
        </div>
        <p class='result_box'>
            
        </p>
    </div>
    <script>
        const state = {
            data: [
                { id: 0, an: '당신의 연령대는?', cate: 'E', qa: ['20대', '30대', '40대', '50대'] },
                { id: 1, an: '당신의 직업군은?', cate: 'E', qa: ['개인사업/자영업', '직장인 근로소득자', '전문직', '프리랜서'] },
                { id: 2, an: '당신의 성별은?', cate: 'E', qa: ['남성', '여성'] },
                { id: 3, an: '나는 나에게 닥쳐올 수도 있는</br> 위험에 충분한 준비가 되어있다', cate: 'A', qa: ['네', '아니요'] },
                { id: 4, an: '나는 돈이 된다는 정보를 들으면</br>본능적으로 하고 싶어한다.', cate: 'B', qa: ['네', '아니요'] },
                { id: 5, an: '나는 투자로 돈을 버는 것은 </br>정보의 싸움이라고 생각한다.', cate: 'C', qa: ['네', '아니요'] },
                { id: 6, an: '나는 큰일에 신경 쓰고 작은 일에는 </br>신경을 쓰지 않는 편이다.', cate: 'D', qa: ['네', '아니요'] },
                { id: 7, an: '나는 새로운 일에 </br>도전하는 것에 조심스럽다', cate: 'A', qa: ['네', '아니요'] },
                { id: 8, an: '나는 머릿속으로 돈을 버는 </br>방법을 항상 생각하고 있다.', cate: 'B', qa: ['네', '아니요'] },
                { id: 9, an: '돈을 깨끗이 하고 </br>정갈하게 보관해야 한다.', cate: 'C', qa: ['네', '아니요'] },
                { id: 10, an: '나는 큰 수익이 나오는 </br>벤처 사업에 관심이 많다', cate: 'D', qa: ['네', '아니요'] },
                { id: 11, an: '남들이 나를 빈틈없고 </br>철저한 사람이라고 한다.', cate: 'A', qa: ['네', '아니요'] },
                { id: 12, an: '나는 돈을 벌기 위해 </br>주식투자를 하고 있거나 할 예정이다.', cate: 'B', qa: ['네', '아니요'] },
                { id: 13, an: '나는 재테크 투자 등을 </br>배우고 해보고 싶다.', cate: 'C', qa: ['네', '아니요'] },
                { id: 14, an: '나는 업그레이드 된 </br>상품이 나오면 꼭 바꿔야만 한다.', cate: 'D', qa: ['네', '아니요'] },
            ],
            resultdata: [
                { id: 0, titid: '모두 아니요를 선택하였습니다.', tit: '테스트를  다시해주세요', desc:''},
                { id: 1, titid: 'A. <span>안전형</span> 타입', tit: '모험을 거는 것은 <span>위험해!</span>', desc: '당신의 재테크 성향은 수익이 적어도 원금 손실 위험이 없는 방법을 선택하려는 <span>안전형 타입</span> 입니다. 안전형 타입은 <span>정기 적금이나 예금, 원금 보장형 CMA 청약</span> 등 원금 손실 없는 금융상품이 적합 합니다. 1~2%대의 낮은 수익만이 예상되지만 성향에 맞게 안전 투자를 할 수 있습니다. 더 큰 수익을 낼 수 있는 안전한 상품을 추천 받으세요.' },
                { id: 2, titid: 'B. <span>중립형</span> 타입', tit: '세상에 <span>공짜로</span> 얻는 건 없어!', desc: '당신의 재테크 성향은 투자하고 있는 금융상품의 위험성을 정확하게 인지하고 있어 수익을 위해서라면 어느정도 손실도 허용 할 수 있는 위험 <span>중립형 타입</span> 입니다. 위험 중립형 타입은 기대 수익률 5~8%대의 <span>적립식 펀드나 채권 혼합형 펀드</span> 등의 금융 상품이 적합 합니다. 다만 손실을 최소로 하기 위한 위험관리 기본 원칙이 필요합니다. 안전한 투자 가이드를 추천 받으세요.'},
                { id: 3, titid: 'C. <span>신중형</span> 타입', tit: '<span>돌다리도</span> 두들겨 보고 간다!', desc: '당신의 재테크 성향은 최대한 원금 손실의 위험을 피하고자 하지만 수익을 위해서는 어느 정도의 손실도 감안할 줄 아는 <span>신중형 타입</span>입니다. 신중형 타입은 국가나 공적 기관에서 발행하여 믿을 수 있는 <span>공국채나 회사채 채권 펀드</span>가 적합 합니다. 다만 금리 시장이 불안정할 때는 예적금 이상의 수익을 낼 수 없다는 것이 단점. 당신만 모르고 있는, 알짜 금융 상품을 추천 받으세요.' },
                { id: 4, titid: 'D. <span>공격 투자형</span> 타입', tit: '고수익을 향해 <span>못먹어도 고!</span>', desc: '당신의 재테크 성향은 원금손실의 위험성을 감수하더라도 고수익 금융상품을 선택하는 <span>공격 투자형 타입</span> 입니다. 공격 투자형 타입은 기대수익률 10%대 이상의 <span>주식 혼합형 펀드나 직접투자 펀드</span> 등 고수익 금융상품이 적합합니다. 투자 성향에 따른 맞춤 금융상품을 추천 받으세요.' },
            ]
        }
        let cateA = [];
        let cateB = [];
        let cateC = [];
        let cateD = [];
        let result_id;
        let result_tit;
        let result_desc;
        let result = [];
        let AnId;
        let params;
        let getQueryString = function(){
        params = {};
        window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(str, key, value) { params[key] = value; });
        return params;
    }()

        function renderAns(a) {
            frontBtn = '';
            if (a > 0) {
                var frontBtn = `<div class='back_btn' onclick='renderAns(${a - 1}),resultBack(${a})'>이전문제</div>`
            }
            if (a < 15) {
                let qas = state.data[a].qa.length;
                if (qas == 4) {
                    ansBtn = `<li class='an-btn' onclick='renderAns(${a + 1}),catePush(${a}),resultPush(${a},0)'>${state.data[a].qa[0]}</li>
                        <li class='an-btn' onclick='renderAns(${a + 1}),catePush(${a}),resultPush(${a},1)'>${state.data[a].qa[1]}</li>
                        <li class='an-btn' onclick='renderAns(${a + 1}),catePush(${a}),resultPush(${a},2)'>${state.data[a].qa[2]}</li>
                        <li class='an-btn' onclick='renderAns(${a + 1}),catePush(${a}),resultPush(${a},3)'>${state.data[a].qa[3]}</li>`
                }
                else {
                    ansBtn = `<li class='an-btn' onclick='renderAns(${a + 1}),catePush(${a}),resultPush(${a},0)'>${state.data[a].qa[0]}</li>
                          <li class='an-btn' onclick='renderAns(${a + 1}),resultPush(${a},1)'>${state.data[a].qa[1]}</li>`
                }
                document.querySelector('.test_box').innerHTML =
                    `<h2 class='test_tit'>${state.data[a].an}</h2>
           <ul>${ansBtn}</ul>
           <div>${frontBtn}</div>`
            }
            else {
                document.querySelector('.test_box').innerHTML =
                    `<h2 class='result-tit'>테스트가 완료되었습니다!</h2>
                        <div class='result-mentions'>
                            <p class='result-mention'>아래의 정보를 입력하시면 당신의 재테크 성향과</p>
                            <p class='result-mention'>그에 따른 맞춤 솔루션을 확인하실 수 있습니다.</p>
                            <p class='result-mention'>테스트를 모두 완료하신 분들께는 20만원 상당의</p>
                            <p class='result-mention'>재무심리 분석자료(무료)를 보내 드립니다.</p>
                        </div>
                        <form id='frm' method='POST'>
                            <ul class='inputs'>
                                <li><div class='input_tit'>성함</div><div class='input_area'><input id='reqname' type='text' autocomplete='off'/></div></li>
                                <li><div class='input_tit'>전화번호</div><div class='input_area'><input id='reqphone' type='number' autocomplete='off'/></div></li>
                                <li><div class='input_tit'>지역</div><div class='input_area'>
                                    <select id='reqarea'>
                                            <option value=''>지역을선택해주세요</option>
                                                <option value="서울">서울특별시</option>
                                                <option value="인천">인천광역시</option>
                                                <option value="경기">경기도</option>
                                                <option value="대전">대전광역시</option>
                                                <option value="세종">세종특별자치시</option>
                                                <option value="부산">부산광역시</option>
                                                <option value="울산">울산광역시</option>
                                                <option value="대구">대구광역시</option>
                                                <option value="광주">광주광역시</option>
                                                <option value="제주">제주특별자치도</option>
                                                <option value="강원">강원도</option>
                                                <option value="충남">충청남도</option>
                                                <option value="충북">충청북도</option>
                                                <option value="경북">경상북도</option>
                                                <option value="경남">충상남도</option>
                                                <option value="전남">전라남도</option>
                                                <option value="전북">전라북도</option>
                                    </select></li>
                            </ul>
                        </form>
                     <p><input type='checkbox' id='checks'>개인 정보 수집 및 이용 동의</p>
                     <div class='result_btn' onclick='resultArray(),dataInsert()'>결과 보러가기</div>`
            }
            return AnId;
        }

        function resultBack(a){
        var cate = state.data[a].cate;
        result.splice(-1, 1);
        if(cate =="A"){
            cateD.splice(-1,1);
        }
        else if(cate =="B"){
            cateA.splice(-1,1);
        }
        else if(cate =="C"){
            cateB.splice(-1,1);
        }
        else if(cate =="D"){
            cateC.splice(-1,1);
        }
        // console.log(result);
    }


        renderAns(0)

        function dataInsert(){
                var reqName = document.getElementById("reqname").value;
                var reqPhone = document.getElementById("reqphone").value;
                var reqArea = document.getElementById("reqarea").value;
                var checks = document.getElementById("checks").checked;

                if(reqName ==''){
                    alert('성함을 입력해주세요')
                }
                else if(reqPhone ==''){
                    alert('연락처를 입력해주세요')

                }
                else if(reqArea ==''){
                    alert('거주 지역을 선택해주세요')
                }
                else if(checks == false){
                    alert('개인정보 수집동의에 체크해주세요')
                }
                else{
                xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function(){
                    if (this.readyState == 4 && this.status == 200) {
                        var returnJson = JSON.parse(this.response);
                        if(returnJson.phpresult =='ok'){
                            alert('상담신청이 완료되었습니다 :)')
                            resultRender()
                        }
                        else{
                            alert('no')
                        }
                    }
                }
                xhttp.open('POST','insult.php',true);
                xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                data = {
                    insult:[reqName,reqPhone,reqArea],
                    answer:result,
                    url:params.id
                }
                xhttp.send("data="+JSON.stringify(data))
                }
            }

            
        function resultRender() {
            document.querySelector('.test-page-h1').innerHTML = `<img src='img/resultpageh1.png' alt=''>`;
            document.querySelector('.test_box').innerHTML =
                `<h2 class='result_h2'>${result_id}
                </h2><h2 class='result_h2'>${result_tit}</h2>
                <p class='result_desc'>${result_desc}</p>`;
            document.querySelector('.result_box').innerHTML=`<img src='img/result_text.png' alt=''>`
        }
        function catePush(a) {
            if (state.data[a].id < 15) {
                let cate = state.data[a].cate;
                if (cate == 'A') {
                    cateA.push(state.data[a].id)
                }
                else if (cate == 'B') {
                    cateB.push(state.data[a].id)
                }
                else if (cate == 'C') {
                    cateC.push(state.data[a].id)
                }
                else if (cate == 'D') {
                    cateD.push(state.data[a].id)
                }
            }
            else {
            }
        }
        function resultPush(a, b) {
            result.push(state.data[a].qa[b])
        }
        function resultArray() {
            var max = Math.max(cateA.length, cateB.length, cateC.length, cateD.length);
            if (max == 0) {
                result_id = state.resultdata[0].titid;
                result_tit = state.resultdata[0].tit;
                result_desc = state.resultdata[0].desc;
            }
            else if (cateB.length >= max) {
                result_id = state.resultdata[2].titid;
                result_tit = state.resultdata[2].tit;
                result_desc = state.resultdata[2].desc;
            }
            else if (cateC.length >= max) { 
                result_id = state.resultdata[3].titid;
                result_tit = state.resultdata[3].tit
                result_desc = state.resultdata[3].desc
            }
            else if (cateD.length >= max) {
                result_id = state.resultdata[4].titid;
                result_tit = state.resultdata[4].tit
                result_desc = state.resultdata[4].desc
            }
            else if (cateA.length >= max) {
                result_id = state.resultdata[1].titid;
                result_tit = state.resultdata[1].tit
                result_desc = state.resultdata[1].desc
            }
            return result_id,result_tit,result_desc;
        }


    </script>

</body>

</html>